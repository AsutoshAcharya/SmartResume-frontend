import{x as $,k as g,C as F,D as I,j as r,B as T,E as w,y as x,w as q,G as B}from"./index-Bn05jdfl.js";import{e as H,a as R,b as k,c as _,T as O,d as z}from"./TextField-B7K_-_Cx.js";import{m as p,A as E}from"./proxy-CIWNrZhA.js";const N={name:"",email:"",password:"",avatar:null},C={name:"",email:"",password:"",avatar:""},M=[{key:"name",label:"Name",type:"text",placeholder:"Enter name",required:!0},{key:"email",label:"Email",type:"text",placeholder:"Enter Email Id",required:!0},{key:"password",label:"Password",type:"password",placeholder:"Enter password",required:!0}];let X=H.create({baseURL:"https://api.cloudinary.com/v1_1/dtl3zxaep",headers:{"Content-Type":"application/json"}}),L="/user";const G=l=>R(()=>k.post(`${L}/register`,l.data)),V=l=>R(()=>k.post(`${L}/login`,l.data)),W=l=>X.post("/image/upload",l.data,{headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"multipart/formdata"}}),j={login:V,register:G,uploadFile:W},Y=()=>{const{signIn:l}=$(),[n,h]=g.useState(N),[c]=F(),o=c.get("type")==="register",[m,y]=g.useState(C),[d,v]=g.useState(null),[u,b]=g.useState(!1),f=I();function S(t,a){var s,i;let e="";if(t==="avatar")return e;switch(t){case"name":e=((s=a==null?void 0:a.toString())==null?void 0:s.length)>=4?((i=a==null?void 0:a.toString())==null?void 0:i.length)<=50?"":"Name must have maximum 50 characters":"Name must have minimum 4 characters";break;case"email":e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)?"":"Invalid email";break;case"password":e=a.length>=6?"":"Password must be at least 6 characters";break}return e}function D(t,a){if(h(e=>({...e,[t]:a})),m[t]){const e=S(t,a);y(s=>({...s,[t]:e}))}}function P(t){const a=n[t],e=S(t,a);y(s=>({...s,[t]:e}))}async function U(t){var a;if(t.preventDefault(),b(!0),!o){const e={data:{email:n.email,password:n.password}};z({fn:()=>j.login(e),onSuccess:s=>{const i=B(s);l(i),f(`${w.PRIVATE.HOME.path}`),x.success("Login Successful")},onError:s=>{x.error((s==null?void 0:s.message)||"Something went wrong",{toastId:"error"})},afterCall:()=>b(!1)});return}try{let e="";if(n.avatar){const i=new FormData;i.append("file",n.avatar),i.append("upload_preset","upload"),i.append("cloud_name","dtl3zxaep");const A=await j.uploadFile({data:i});e=A.data.secure_url||A.data.url}const s={data:{name:n.name,email:n.email,password:n.password,avatar:e}};await j.register(s),x.success("Registration successful"),c.set("type","login"),f(`${w.PUBLIC.AUTH.path}?${c.toString()}`)}catch(e){x.error(Array.isArray(e==null?void 0:e.message)?q.Array(e==null?void 0:e.message).join(","):((a=e==null?void 0:e.data)==null?void 0:a.message)||"Something went wrong")}finally{b(!1)}}return r.jsx("div",{className:"w-screen h-screen bg-gradient-to-br from-blue-50 to-purple-100 flex justify-center items-center p-4",children:r.jsxs(p.form,{onSubmit:U,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3},className:"w-full max-w-md bg-white/80 backdrop-blur-lg shadow-xl rounded-3xl px-8 py-10 space-y-6 border border-white/30",children:[r.jsx(p.h2,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1},className:"text-3xl font-semibold text-center text-gray-700",children:o?"Create an Account":"Login"}),r.jsx(E,{mode:"wait",children:M.map((t,a)=>!o&&(t.key==="name"||t.key==="avatar")?null:r.jsx(p.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},exit:{x:-20,opacity:0},transition:{delay:.05*a},children:r.jsx(_,{type:t.type,label:t.label,value:n[t.key],placeholder:t.placeholder,onChange:e=>D(t.key,e),onBlur:()=>P(t.key),required:t.required,error:m[t.key],disabled:u})},t.key))}),r.jsx(E,{children:o&&r.jsxs(p.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1},exit:{x:20,opacity:0},transition:{duration:.3},children:[r.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Avatar"}),r.jsx("input",{type:"file",accept:"image/*",onChange:t=>{const{files:a}=t.target;if(a){const e=a[0];h(s=>({...s,avatar:e})),v(URL.createObjectURL(e))}},className:"block w-full text-sm text-gray-600"},d==null?void 0:d.toString()),d&&r.jsx(p.img,{src:d,alt:"Avatar Preview",className:"w-16 h-16 mt-3 rounded-full border-2 border-blue-400 object-cover",initial:{scale:0},animate:{scale:1},exit:{scale:0},transition:{type:"spring",stiffness:200}}),m.avatar&&r.jsx("p",{className:"text-sm text-red-500 mt-1",children:m.avatar})]},"avatar")}),r.jsx(T,{type:"submit",disabled:Object.values(m).some(t=>t)||u,className:"w-full py-2 px-4 text-white rounded-xl font-medium shadow-sm transition cursor-pointer",loading:u,children:o?"Register":"Login"}),r.jsxs("div",{className:"flex justify-center items-center gap-2 pt-2 text-sm",children:[r.jsx(O,{children:o?"Already have an account?":"Donâ€™t have an account?",variant:"subtle"}),r.jsx("button",{type:"button",className:"text-blue-600 font-medium underline cursor-pointer",onClick:()=>{c.set("type",o?"login":"register"),f(`${w.PUBLIC.AUTH.path}?${c.toString()}`),h(N),y(C),v(null)},disabled:u,children:o?"Login":"Register"})]})]})})};export{Y as default};
