import{x as U,k as p,C as $,D as I,j as t,B as T,E as b,y as d,w as q,G as F}from"./index-BDMm7OV4.js";import{e as B,a as N,b as C,c as H,T as _,d as O}from"./TextField-CsPeshwS.js";import{m,A as k}from"./proxy-ByeBQAtp.js";const A={name:"",email:"",password:"",avatar:null},S={name:"",email:"",password:"",avatar:""},z=[{key:"name",label:"Name",type:"text",placeholder:"Enter name",required:!0},{key:"email",label:"Email",type:"text",placeholder:"Enter Email Id",required:!0},{key:"password",label:"Password",type:"password",placeholder:"Enter password",required:!0}];let M=B.create({baseURL:"https://api.cloudinary.com/v1_1/dtl3zxaep",headers:{"Content-Type":"application/json"}}),E="/user";const X=l=>N(()=>C.post(`${E}/register`,l.data)),G=l=>N(()=>C.post(`${E}/login`,l.data)),V=l=>M.post("/image/upload",l.data,{headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"multipart/formdata"}}),w={login:G,register:X,uploadFile:V},Y=()=>{const{signIn:l,cred:W}=U(),[n,x]=p.useState(A),[c]=$(),i=c.get("type")==="register",[u,v]=p.useState(S),[f,R]=p.useState(null),[h,g]=p.useState(!1),y=I();function L(a,s){x(e=>({...e,[a]:s}))}function D(a){let s="",e=a;const r=n[e];switch(e){case"name":s=r.length>=4?r.length<=50?"":"Name must have maximum 50 characters":"Name must have minimum 4 characters";break;case"email":s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)?"":"Invalid email";break;case"password":s=r.length>=6?"":"Password must be at least 6 characters";break}v(o=>({...o,[a]:s}))}async function P(a){var s;if(a.preventDefault(),g(!0),!i){const e={data:{email:n.email,password:n.password}};O({fn:()=>w.login(e),onSuccess:r=>{const o=F(r);l(o),y(`${b.PRIVATE.HOME.path}`),d.success("Login Successful")},onError:r=>{d.error((r==null?void 0:r.message)||"Something went wrong",{toastId:"error"})},afterCall:()=>g(!1)});return}try{let e="";if(n.avatar){const o=new FormData;o.append("file",n.avatar),o.append("upload_preset","upload"),o.append("cloud_name","dtl3zxaep");const j=await w.uploadFile({data:o});e=j.data.secure_url||j.data.url}const r={data:{name:n.name,email:n.email,password:n.password,avatar:e}};await w.register(r),d.success("Registration successful"),c.set("type","login"),y(`${b.PUBLIC.AUTH.path}?${c.toString()}`)}catch(e){console.warn(e),d.error(Array.isArray(e==null?void 0:e.message)?q.Array(e==null?void 0:e.message).join(","):((s=e==null?void 0:e.data)==null?void 0:s.message)||"Something went wrong"),console.error(e)}finally{g(!1)}}return t.jsx("div",{className:"w-screen h-screen bg-gradient-to-br from-blue-50 to-purple-100 flex justify-center items-center p-4",children:t.jsxs(m.form,{onSubmit:P,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3},className:"w-full max-w-md bg-white/80 backdrop-blur-lg shadow-xl rounded-3xl px-8 py-10 space-y-6 border border-white/30",children:[t.jsx(m.h2,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1},className:"text-3xl font-semibold text-center text-gray-700",children:i?"Create an Account":"Login"}),t.jsx(k,{mode:"wait",children:z.map((a,s)=>!i&&(a.key==="name"||a.key==="avatar")?null:t.jsx(m.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},exit:{x:-20,opacity:0},transition:{delay:.05*s},children:t.jsx(H,{type:a.type,label:a.label,value:n[a.key],placeholder:a.placeholder,onChange:e=>L(a.key,e),onBlur:()=>D(a.key),required:a.required,error:u[a.key],disabled:h})},a.key))}),t.jsx(k,{children:i&&t.jsxs(m.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1},exit:{x:20,opacity:0},transition:{duration:.3},children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Avatar"}),t.jsx("input",{type:"file",accept:"image/*",onChange:a=>{const{files:s}=a.target;if(s){const e=s[0];x(r=>({...r,avatar:e})),R(URL.createObjectURL(e))}},className:"block w-full text-sm text-gray-600"}),f&&t.jsx(m.img,{src:f,alt:"Avatar Preview",className:"w-16 h-16 mt-3 rounded-full border-2 border-blue-400 object-cover",initial:{scale:0},animate:{scale:1},exit:{scale:0},transition:{type:"spring",stiffness:200}}),u.avatar&&t.jsx("p",{className:"text-sm text-red-500 mt-1",children:u.avatar})]},"avatar")}),t.jsx(T,{type:"submit",disabled:Object.values(u).some(a=>a)||h,className:"w-full py-2 px-4 text-white rounded-xl font-medium shadow-sm transition cursor-pointer",loading:h,children:i?"Register":"Login"}),t.jsxs("div",{className:"flex justify-center items-center gap-2 pt-2 text-sm",children:[t.jsx(_,{children:i?"Already have an account?":"Donâ€™t have an account?",variant:"subtle"}),t.jsx("button",{type:"button",className:"text-blue-600 font-medium underline cursor-pointer",onClick:()=>{c.set("type",i?"login":"register"),y(`${b.PUBLIC.AUTH.path}?${c.toString()}`),x(A),v(S)},children:i?"Login":"Register"})]})]})})};export{Y as default};
